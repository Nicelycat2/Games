<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FATE V3 - Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" href="media/logo.svg" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap");
      
      :root {
        --primary-color: #0f3460;
        --secondary-color: #1e5f8e;
        --accent-color: #3d84b8;
        --bg-2-color: #16213e;
        --bg-color: #0a0a23;
        --text-color: #e0e0e0;
        --text-secondary-color: #a0c8e6;
        --text-placeholder-color: #5a7a9c;
        --border-color: #2c3e50;
        --font-family: "Poppins", sans-serif;
        --font-size: 16px;
        --border-radius: 12px;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--font-family);
        font-size: var(--font-size);
        background-image: 
          radial-gradient(circle at 10% 20%, rgba(15, 52, 96, 0.1) 0%, transparent 20%),
          radial-gradient(circle at 90% 80%, rgba(61, 132, 184, 0.1) 0%, transparent 20%);
      }

      /* Navigation bar styles */
      .nav-glass {
        background: rgba(22, 33, 62, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(61, 132, 184, 0.3);
      }

      .nav-link {
        transition: all 0.2s ease;
      }

      .nav-link:hover {
        color: #ffffff;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
      }

      .game-popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(10, 10, 35, 0.95);
        z-index: 9999;
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
      }

      .game-popup-container {
        width: 95%;
        height: 95%;
        max-width: 1400px;
        max-height: 900px;
        background: var(--bg-2-color);
        border-radius: var(--border-radius);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(15, 52, 96, 0.5);
        border: 1px solid rgba(61, 132, 184, 0.3);
      }

      .game-popup-header {
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border-color);
        background: linear-gradient(135deg, var(--bg-2-color) 0%, #1a2a4a 100%);
      }

      .game-popup-title {
        color: var(--text-color);
        font-size: 18px;
        font-weight: 600;
        flex: 1;
        text-align: center;
        text-shadow: 0 0 8px rgba(224, 224, 224, 0.5);
      }

      .game-popup-close,
      .game-popup-fullscreen {
        background: var(--border-color);
        border: none;
        color: var(--text-color);
        width: 36px;
        height: 36px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 18px;
      }

      .game-popup-close:hover,
      .game-popup-fullscreen:hover {
        background: var(--secondary-color);
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(30, 95, 142, 0.5);
        color: #ffffff;
      }

      .game-popup-content {
        flex: 1;
        position: relative;
        background: var(--bg-color);
      }

      .game-popup-content iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .bg-gray-900 {
        background-color: var(--bg-color) !important;
      }

      .text-white {
        color: var(--text-color) !important;
        text-shadow: 0 0 5px rgba(224, 224, 224, 0.3);
      }

      .bg-gray-800 {
        background-color: var(--bg-2-color) !important;
      }

      .text-gray-400 {
        color: var(--text-secondary-color) !important;
      }

      .border-gray-700 {
        border-color: var(--border-color) !important;
      }

      .focus\:border-purple-500:focus {
        border-color: var(--primary-color) !important;
      }

      .text-purple-500 {
        color: var(--primary-color) !important;
        text-shadow: 0 0 8px rgba(15, 52, 96, 0.4);
      }

      .text-gray-500 {
        color: var(--text-placeholder-color) !important;
      }

      .text-red-500 {
        color: var(--accent-color) !important;
        text-shadow: 0 0 5px rgba(61, 132, 184, 0.3);
      }

      .text-green-500 {
        color: var(--secondary-color) !important;
      }

      .text-yellow-500 {
        color: #64b5f6 !important;
        text-shadow: 0 0 5px rgba(100, 181, 246, 0.3);
      }

      .text-blue-500 {
        color: var(--primary-color) !important;
      }

      .bg-red-500 {
        background-color: var(--accent-color) !important;
        box-shadow: 0 0 5px rgba(61, 132, 184, 0.3);
      }

      .bg-green-500 {
        background-color: var(--secondary-color) !important;
      }

      .bg-yellow-500 {
        background-color: #64b5f6 !important;
        box-shadow: 0 0 5px rgba(100, 181, 246, 0.3);
      }

      .bg-blue-500 {
        background-color: var(--primary-color) !important;
      }

      .shadow-purple-500\/50 {
        box-shadow: 0 0 20px rgba(15, 52, 96, 0.5) !important;
      }

      input:focus {
        box-shadow: 0 0 10px rgba(15, 52, 96, 0.3) !important;
      }

      a:hover {
        color: #ffffff !important;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
      }

      button:hover {
        color: #ffffff !important;
      }

      /* White Aura Effect for Main Title */
      h1 span {
        text-shadow: 
          0 0 10px rgba(255, 255, 255, 0.7),
          0 0 20px rgba(255, 255, 255, 0.5),
          0 0 30px rgba(255, 255, 255, 0.3);
      }

      /* Additional glow for interactive elements */
      .hover\:scale-105:hover {
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));
      }

      /* Add padding to account for fixed nav */
      body {
        padding-top: 80px;
      }
    </style>
  </head>

  <body class="bg-gray-900 text-white min-h-screen">
    <!-- Navigation Bar -->
    <nav class="nav-glass fixed top-0 left-0 right-0 z-50 px-6 py-3">
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-3">
          <img src="media/logo.svg" alt="FATE V3" class="w-10 h-10" style="filter: drop-shadow(0 0 8px rgba(255,255,255,0.5));">
          <span class="text-xl font-bold text-white">FATE V3</span>
        </div>
        <div class="flex gap-6 items-center">
          <a href="index.html" class="nav-link text-blue-300 hover:text-white font-medium flex items-center gap-2">
            <i class="fas fa-home"></i> Home
          </a>
          <a href="https://discord.gg/MfEnRxxxA" target="_blank" class="nav-link text-blue-300 hover:text-white font-medium">
            <i class="fab fa-discord"></i> Discord
          </a>
        </div>
      </div>
    </nav>

    <div x-data="gamesApp()" x-init="init()">
      <header class="p-6 text-center">
        <h1 class="text-4xl font-bold">
          <span>FATE V3 Games</span>
        </h1>
        <p class="text-center mt-2 text-sm" style="color: var(--text-secondary-color);">Ultimate Gaming Collection</p>
      </header>

      <main class="container mx-auto p-4 max-w-7xl">
        <div class="mb-6 space-y-4">
          <input
            type="text"
            x-model="searchQuery"
            @input="applyFilters()"
            :placeholder="searchPlaceholder"
            class="w-full px-4 py-3 bg-gray-800 text-white rounded-2xl border border-gray-700 focus:outline-none focus:border-purple-500 transition"
          />

          <div class="text-center text-gray-400">
            <span x-text="filteredGames.length"></span> games available
          </div>
        </div>

        <div x-show="loading" class="text-center py-12">
          <i class="fa-solid fa-spinner fa-spin text-4xl text-purple-500"></i>
          <p class="mt-4 text-gray-400">Loading games...</p>
        </div>

        <div
          x-show="!loading && filteredGames.length === 0"
          class="text-center py-12"
        >
          <i class="fa-solid fa-circle-exclamation text-4xl text-gray-500"></i>
          <p class="mt-4 text-gray-400">No games found.</p>
        </div>

        <div
          x-show="!loading && filteredGames.length > 0"
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"
        >
          <template x-for="(game, index) in filteredGames" :key="index">
            <div
              class="bg-gray-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-purple-500/50 transition-all hover:scale-105 cursor-pointer"
              @click="openGame(game)"
            >
              <div class="relative aspect-square bg-gray-700">
                <img
                  :src="getGameImage(game)"
                  :alt="game.name"
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
                <div class="absolute top-2 left-2 flex flex-col gap-1">
                  <span
                    x-show="game.top"
                    class="bg-red-500 text-white text-xs px-2 py-1 rounded font-bold"
                  >
                    <i class="fa-solid fa-fire"></i> HOT
                  </span>
                  <span
                    x-show="game.new"
                    class="bg-green-500 text-white text-xs px-2 py-1 rounded font-bold"
                  >
                    <i class="fa-solid fa-sparkles"></i> NEW
                  </span>
                  <span
                    x-show="game.exp"
                    class="bg-yellow-500 text-white text-xs px-2 py-1 rounded font-bold"
                  >
                    <i class="fa-solid fa-vial"></i> EXP
                  </span>
                  <span
                    x-show="game.updated"
                    class="bg-blue-500 text-white text-xs px-2 py-1 rounded font-bold"
                  >
                    <i class="fa-solid fa-sparkles"></i> UPDATED
                  </span>
                </div>
              </div>

              <div class="p-3">
                <p
                  class="text-sm font-semibold text-center truncate"
                  x-text="game.name"
                ></p>
              </div>
            </div>
          </template>
        </div>
      </main>

      <div
        class="game-popup-overlay"
        x-show="popupOpen"
        @click.self="closePopup()"
      >
        <div class="game-popup-container">
          <div class="game-popup-header">
            <div style="width: 36px"></div>
            <div
              class="game-popup-title"
              x-text="currentGame?.name || 'Loading...'"
            ></div>
            <div style="display: flex; flex-direction: row; gap: 4px">
              <button class="game-popup-fullscreen" @click="fullscreenPopup()">
                <i class="fa-solid fa-expand"></i>
              </button>
              <button class="game-popup-close" @click="closePopup()">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>
          <div class="game-popup-content">
            <iframe x-ref="gameFrame"></iframe>
          </div>
        </div>
      </div>

      <div
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        x-show="showWarningModal"
        x-transition
      >
        <div class="bg-gray-800 p-6 rounded-lg max-w-md mx-4 border" style="border-color: #0f3460;">
          <h2 class="text-xl font-bold mb-4" style="color: #e0e0e0;">Important Notice</h2>
          <p class="text-gray-300 mb-4">
            Welcome to FATE V3! Remember to sync periodically to keep
            the games list updated and ensure all games continue working properly.
          </p>
          <button
            @click="showWarningModal = false; localStorage.setItem('warningModalShown', 'true');"
            class="hover:bg-purple-700 px-4 py-2 rounded-xl"
            style="background-color: #0f3460; color: #ffffff; font-weight: bold;"
          >
            Got it!
          </button>
        </div>
      </div>

      <!-- VISITOR COUNTER FOOTER -->
      <footer class="mt-12 py-6 text-center text-gray-500 text-sm">
        <div style="margin-bottom: 15px; padding: 15px; background: rgba(15, 52, 96, 0.2); border-radius: 8px; display: inline-block;">
          <span style="color: #e0e0e0; font-size: 16px; font-weight: 600;">üë• Total Visitors: </span>
          <a href='https://www.free-counters.org/' style="display: none;">https://www.free-Counters.org</a>
          <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=aac3697a17827feb76b9c30b1d439798f92b3329'></script>
          <script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1486140/t/3"></script>
        </div>
        <p style="margin-top: 10px;">FATE V3 - Made with ‚ù§Ô∏è</p>
      </footer>
    </div>

    <script>
      const cdnUrl = "https://mathcenter.space";
      const cdnUrl2 = "https://corsproxy.io/?url=";

      function gamesApp() {
        return {
          allGames: [],
          filteredGames: [],
          searchQuery: "",
          searchPlaceholder: "Search for games",
          loading: true,
          popupOpen: false,
          currentGame: null,
          showWarningModal: true,

          async init() {
            this.showWarningModal =
              !window.location.search.includes("nomodal") &&
              !localStorage.getItem("warningModalShown");

            console.log(
              "%cFATE%c V3 - Loading...",
              "font-size: 16px; background-color: #0f3460; border-radius: 5px 0 0 5px; padding: 4px; font-weight: bold;",
              "font-size: 16px; background-color: #0a0a23; font-weight: bold; padding: 4px; border-radius: 0 5px 5px 0;"
            );

            try {
              const responses = await Promise.allSettled([
                fetch("./json/games.json").then((r) => r.json()),
                fetch(cdnUrl2 + "https://mathcenter.space/cdn/all").then((r) =>
                  r.json()
                ),
              ]);

              this.allGames = responses
                .filter((r) => r.status === "fulfilled")
                .flatMap((r) => r.value);

              console.log(`Loaded ${this.allGames.length} games`);
              this.searchPlaceholder = `Search for ${this.allGames.length} games`;
              this.applyFilters();
            } catch (error) {
              console.error("Error loading games:", error);
            } finally {
              this.loading = false;
            }
          },

          applyFilters() {
            let filtered = this.allGames;

            if (this.searchQuery) {
              filtered = filtered.filter((game) =>
                game.name.toLowerCase().includes(this.searchQuery.toLowerCase())
              );
            }

            filtered = [...filtered].sort((a, b) => {
              if (a.name === "Request a game") return -1;
              if (b.name === "Request a game") return 1;
              if (a.new && !b.new) return -1;
              if (!a.new && b.new) return -1;
              if (a.top && !b.top) return -1;
              if (!a.top && b.top) return 1;
              return 0;
            });

            this.filteredGames = filtered;
            this.searchPlaceholder = `Search for ${filtered.length} game${
              filtered.length !== 1 ? "s" : ""
            }`;
          },

          getGameImage(game) {
            if (game.image?.startsWith("https://")) {
              return game.image;
            }
            if (game.proxy) {
              return cdnUrl + `/media/games/${game.image}`;
            } else {
              const firstSegment = game.url?.split("/")[0] || "";
              return cdnUrl + `/cdn/${firstSegment}/${game.image}`;
            }
          },

          async openGame(game) {
            console.log("Opening game:", game.name);
            this.currentGame = game;
            this.popupOpen = true;

            await this.$nextTick();
            const iframe = this.$refs.gameFrame;
            console.log("Iframe ref:", iframe);

            if (game.url?.includes("jsdelivr")) {
              try {
                const response = await fetch(game.url);
                const html = await response.text();
                iframe.contentDocument.open();
                iframe.contentDocument.write(html);
                iframe.contentDocument.close();
              } catch (error) {
                console.error("Error loading jsdelivr content:", error);
              }
            } else if (!game.proxy) {
              iframe.src = cdnUrl + `/cdn/${game.url}/`;
            } else {
              iframe.src = game.url;
            }
          },

          closePopup() {
            console.log("Closing popup");
            this.popupOpen = false;
            this.currentGame = null;

            const iframe = this.$refs.gameFrame;
            if (iframe) {
              iframe.src = "about:blank";
            }
          },

          fullscreenPopup() {
            const iframe = this.$refs.gameFrame;
            if (iframe.requestFullscreen) {
              iframe.requestFullscreen();
            } else if (iframe.mozRequestFullScreen) {
              iframe.mozRequestFullScreen();
            } else if (iframe.webkitRequestFullscreen) {
              iframe.webkitRequestFullscreen();
            } else if (iframe.msRequestFullscreen) {
              iframe.msRequestFullscreen();
            }
          },
        };
      }
    </script>
  </body>
</html>
